language: java

matrix:
  include:
    - jdk: openjdk8
      dist: xenial


before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/

script:
  # unshallow git repository
  - 'if [ "$TRAVIS_JDK_VERSION"  = "openjdk8" -a  "$SONAR_TOKEN" != "" ]; then git fetch --unshallow --quiet; fi'
  # the following command line builds the project, runs the tests with coverage and then execute the SonarCloud analysis
  - 'if [ "$TRAVIS_JDK_VERSION" != "openjdk8" -o  "$SONAR_TOKEN"  = "" ]; then ./gradlew check javadoc asciidoc; fi'
deploy:
  - provider: pages
    skip-cleanup: true
    github-token: $GITHUB_TOKEN
    keep-history: true
    local-dir: build/asciidoc/html5
    target-branch: gh-pages
    on:
      branch: master
      jdk: openjdk8
